<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jock Currie, Natasha Besseling">
<meta name="dcterms.date" content="2025-05-13">

<title>Collaborating with Git</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="collaborating_with_git_files/libs/clipboard/clipboard.min.js"></script>
<script src="collaborating_with_git_files/libs/quarto-html/quarto.js"></script>
<script src="collaborating_with_git_files/libs/quarto-html/popper.min.js"></script>
<script src="collaborating_with_git_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="collaborating_with_git_files/libs/quarto-html/anchor.min.js"></script>
<link href="collaborating_with_git_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="collaborating_with_git_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="collaborating_with_git_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="collaborating_with_git_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="collaborating_with_git_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#getting-organised" id="toc-getting-organised" class="nav-link active" data-scroll-target="#getting-organised"><span class="header-section-number">1</span> Getting organised</a>
  <ul class="collapse">
  <li><a href="#sec-avoidDupl" id="toc-sec-avoidDupl" class="nav-link" data-scroll-target="#sec-avoidDupl"><span class="header-section-number">1.1</span> How do we avoid many duplicated input files across different projects?</a></li>
  </ul></li>
  <li><a href="#version-control" id="toc-version-control" class="nav-link" data-scroll-target="#version-control"><span class="header-section-number">2</span> Version control</a>
  <ul class="collapse">
  <li><a href="#what-is-git" id="toc-what-is-git" class="nav-link" data-scroll-target="#what-is-git"><span class="header-section-number">2.1</span> What is Git?</a></li>
  <li><a href="#what-is-gitlabgithub" id="toc-what-is-gitlabgithub" class="nav-link" data-scroll-target="#what-is-gitlabgithub"><span class="header-section-number">2.2</span> What is GitLab/GitHub?</a></li>
  <li><a href="#connecting-to-githubgitlab" id="toc-connecting-to-githubgitlab" class="nav-link" data-scroll-target="#connecting-to-githubgitlab"><span class="header-section-number">2.3</span> Connecting to GitHub/GitLab</a></li>
  <li><a href="#common-git-functions" id="toc-common-git-functions" class="nav-link" data-scroll-target="#common-git-functions"><span class="header-section-number">2.4</span> Common Git functions</a></li>
  <li><a href="#the-importance-of-.gitignore" id="toc-the-importance-of-.gitignore" class="nav-link" data-scroll-target="#the-importance-of-.gitignore"><span class="header-section-number">2.5</span> The importance of <em>.gitignore</em></a></li>
  <li><a href="#sec-renviron" id="toc-sec-renviron" class="nav-link" data-scroll-target="#sec-renviron"><span class="header-section-number">2.6</span> The <em>.Renviron</em> file</a></li>
  <li><a href="#things-to-watch-out-for" id="toc-things-to-watch-out-for" class="nav-link" data-scroll-target="#things-to-watch-out-for"><span class="header-section-number">2.7</span> Things to watch out for</a></li>
  </ul></li>
  <li><a href="#the-importance-of-branches" id="toc-the-importance-of-branches" class="nav-link" data-scroll-target="#the-importance-of-branches"><span class="header-section-number">3</span> The importance of branches</a></li>
  <li><a href="#sec-datarepo" id="toc-sec-datarepo" class="nav-link" data-scroll-target="#sec-datarepo"><span class="header-section-number">4</span> A centralised data repository (with SANBI IT systems)</a></li>
  <li><a href="#general-notes-on-good-data-hygiene-see-borer-et-al.-2009" id="toc-general-notes-on-good-data-hygiene-see-borer-et-al.-2009" class="nav-link" data-scroll-target="#general-notes-on-good-data-hygiene-see-borer-et-al.-2009"><span class="header-section-number">5</span> General notes on good data hygiene (See Borer et al.&nbsp;2009)</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6</span> References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Collaborating with Git</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jock Currie, Natasha Besseling </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">13 May 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="getting-organised" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Getting organised</h1>
<p>Your greatest collaborator ever is likely to be your future self. Do yourself (and all other collaborators) a great service by keeping an organised and well documented project that they can navigate and understand with relative ease. The biggest impediment to collaboration is finding (and understanding) the pertinent information.</p>
<p>There are different ways of structuring your project directories to keep them organised. In our team we try to keep a fairly standardised structure as below (recognising that some projects will have unique requirements):</p>
<ul>
<li><strong><em>project</em></strong> (root) folder
<ul>
<li>The “home” of your stand-alone project. It should typically contain everything the project needs and all the resultant outputs, organised in meaningful subfolders. It also contains your <em>README.md</em>, <em>.Rproj</em> and <em>.gitignore</em> files (which are created automatically).<br>
</li>
</ul></li>
<li><strong><em>data</em></strong> folder
<ul>
<li>All your input data (often included via a <strong>link</strong>); these files generally do not get altered or over-written by your project scripts. You can modify your input data with your scripts, but do not overwrite the original input file (save an intermediate output file if necessary).<br>
</li>
</ul></li>
<li><strong><em>scripts</em></strong> folder
<ul>
<li>All your scripts that contribute to your workflow (the documented ‘recipes’ of your work)<br>
</li>
</ul></li>
<li><strong><em>outputs</em></strong> folder
<ul>
<li>Any and all results saved by the scripts (besides the images that we prefer to put in plots); these could be further divided into types of outputs if you would like.<br>
</li>
</ul></li>
<li><strong><em>plots</em></strong> folder
<ul>
<li>Any outputs that consist of image files (plots/figures) that you may want to include in reports or help visualise your results.</li>
</ul></li>
</ul>
<p>Therefore, anything written (saved) by the scripts is written to “outputs/…” or to “plots/…”. We generally avoid writing to the <em>data</em> directory as we want to strictly avoid changing input files. We also tend to avoid writing into the root directory as that might get crowded and chaotic if we generate a lot of files. See our <a href="https://gitlab.com/jockongl/r_project_template">project_template</a> if interested.</p>
<section id="sec-avoidDupl" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-avoidDupl"><span class="header-section-number">1.1</span> How do we avoid many duplicated input files across different projects?</h2>
<p>One solution is the use of symbolic links (or directory junctions), which you create inside your project <em>data</em> directory and which point to a target folder that is stored elsewhere on your computer and contains the input data.</p>
<p>In the Windows Command Prompt (cmd), use the <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/mklink">mklink</a> function in the following way:</p>
<p>mklink /d “absolute_path\to\your\Rproject\data\link2gis” “absolute_path\to\your\data\gis”</p>
<p>to create a linked folder (first set of inverted commas) that points to your target folder (second set of inverted commas). Hint: copy the absolute paths from your Windows Explorer.</p>
<p>If you require admin rights to do so and lack them, then use <em>/j</em> instead of <em>/d</em>, which ironically, seems potentially more risky (at least in our context). See some <a href="https://en.wikipedia.org/wiki/Symbolic_link#NTFS_symbolic_link">background about links</a> and a very brief <a href="https://gitlab.com/nba_2025/symbolic_links_testing">link testing project</a> for further info.</p>
<p><strong>Warning:</strong> In Windows, do not copy linked folders from one location to another (e.g.&nbsp;to replicate them from one R project to another), as they seem to paste the target contents and not a linked folder. *Please shout if anyone knows how to get around this problem.</p>
<p>If you repeat the above approach of linked folders across all your R projects, they can all point to a single directory that houses your input data somewhere else on your computer.</p>
<p><strong>NB Warning:</strong> Always ensure that you add the symbolic link, e.g.&nbsp;<em>data/link2gis</em> in the above example, or your entire <em>data/</em> folder, to the <em>.gitignore</em> file! Otherwise, Git will try to stage and commit your entire linked data directory, which might not be intended and may often be huge.</p>
<p>By creating the above linked folders, together with the use of the R function <em>list.files()</em> to search for and load your input files, we can have complete interoperability between different machines (or collaborators), even if they have their data stored in different places (under different folder names).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### example</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## load the spatial features and dplyr packages (install them if you have not yet done so)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"sf"</span>)) <span class="fu">install.packages</span>(<span class="st">"sf"</span>); <span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"dplyr"</span>)) <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>); <span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## create file paths (find the correct path, which can vary among different machines)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>mem_fl <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../data"</span>, <span class="at">pattern =</span> <span class="st">"^Marine_Ecosystem_Map_2023_final_pelagic_only.gpkg$"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="co"># we include '../' to go up one directory level to the root folder, because I created a 'quarto' folder and unlike other (normal .R) scripts, quarto files get rendered from the folder they are saved in. But, running it in the R console, we need to remove the '../' as the default working directory is the project root directory. this difference between the 'working directory' of quarto files and the R console or R scripts, can be avoided by using the here() function:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mem_fl &lt;- list.files(path = here::here("data"), pattern = "^Marine_Ecosystem_Map_2023_final_pelagic_only.gpkg$", recursive = TRUE, full.names = TRUE)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">## load the spatial file </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>mem <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="at">dsn =</span> mem_fl)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the pelagic ecosystem types</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(mem), axes=T)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>mem <span class="sc">%&gt;%</span> </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(P_EcosysType) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">axes =</span> T, <span class="at">key.pos =</span> <span class="cn">NULL</span>, <span class="at">main =</span> <span class="st">"Pelagic Ecosystem Types"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="collaborating_with_git_files/figure-html/load_data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The file will be found as long as it exists somewhere within the path specified. To demonstrate, rename the ‘pretend_link2gis’ folder name and rerun it. Obviously, for consistent results and reproducibility, the collaborators need to ensure they have precisely the same input data! See <a href="#sec-datarepo" class="quarto-xref">Section&nbsp;4</a> for a trick to accomplish that.</p>
</section>
</section>
<section id="version-control" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Version control</h1>
<p>Once we have our data and file structures organised, we need to try and write organised and well-documented code. To track updates to the code, snapshot specific versions (e.g.&nbsp;of results shared with a collaborator or used in an output), and remain organised among multiple collaborators working on the same project, we need a version control system.</p>
<section id="what-is-git" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="what-is-git"><span class="header-section-number">2.1</span> What is Git?</h2>
<p>A solution to <strong>track</strong> and <strong>document</strong> changes to files (inputs, outputs, results, document versions, etc). It allows you to take a snapshot of your project contents at a point in time and save it with a meaningful commit message, so that you can roll back to that previous state (or recover individual files from that state) at any future time.</p>
<p>Git will track changes in any file formats, including Word documents, spatial files, etc. However, the very useful <a href="https://www.datacamp.com/tutorial/git-diff-guide"><em>git diff</em></a> function, which highlights differences in the <strong>content</strong> between file versions, works only for selected (mostly text) file types.</p>
<p>Before you start using Git for the first time, you need to set your credentials either within a terminal:<br>
</p>
<blockquote class="blockquote">
<p>git config --global user.name [YOUR NAME]<br>
git config --global user.email [YOUR EMAIL]</p>
</blockquote>
<p>Alternatively, in R, you can use the <em>usethis</em> package as follows:</p>
<blockquote class="blockquote">
<p>library(usethis) use_git_config(user.name = “Jane Doe”, user.email = “jane@example.org”)</p>
</blockquote>
<p>See some <a href="https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address">GitHub information</a> on the commit email address, which you may want to read if you’re worried about exposing your email address online.</p>
<section id="initialise-git" class="level3">
<h3 class="anchored" data-anchor-id="initialise-git">Initialise Git</h3>
<p>Once your Git profile is created, you can initialise (activate) Git on any project (folder). This action is needed only once for each project and if you clone a remote repository, you bypass this step as the cloned repository is already initialised.</p>
<p>In RStudio, it can be achieved via <em>Tools</em> &gt; <em>Project Options</em> &gt; <em>Git/SVN</em>; select <em>Git</em> under <em>Version control system</em>.</p>
<p>Alternatively, simply type <mark><em>git init</em></mark> in a terminal, ensuring you’re in the project root folder.</p>
<p>The .git folder appears inside your project folder once you have initialised Git on that project and it contains the (magic) history that tracks your committed versions over time.</p>
</section>
</section>
<section id="what-is-gitlabgithub" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="what-is-gitlabgithub"><span class="header-section-number">2.2</span> What is GitLab/GitHub?</h2>
<p>An online platform that allows you to share your project with the public, or selected collaborators, and your collaborators are able to make changes that you can then ‘accept’ (merge) into your project. The updated versions or changes to the project are ‘pushed’ (from computer to online repository) and ‘pulled’ (from online repository to computer) with Git commands.</p>
<p>If you would like to version control your work on your own computer (and nothing further), then you need only the Git software installed. If you would like to create an online repository (copy of your project) so that others can see it, or to be able to share your work with collaborators, then you will additionally need to create a profile on GitLab or GitHub (or equivalent) and ‘push’ your project to an online repository.</p>
<p>We will only scratch the surface of the most common Git operations. An excellent resource for finding your feet with Git and using it with R is Jenny Bryan’s <a href="https://happygitwithr.com/">Happy Git and GitHub for the useR</a>.</p>
</section>
<section id="connecting-to-githubgitlab" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="connecting-to-githubgitlab"><span class="header-section-number">2.3</span> Connecting to GitHub/GitLab</h2>
<p>Making the secure connection between RStudio (or Git) on your computer and your GitHub or GitLab profile can sometimes be a frustrating exercise. There are <a href="https://happygitwithr.com/connect-intro">multiple ways of going about it</a>, please read the relevant instructions for GitHub or GitLab. I have avoided trying to use SSH, mainly because I remember a staff member of mine struggling to SSH to a cluster computer from the SANBI network a few years ago (due to SANBI network restrictions). If anyone is using a SSH connection with GitHub/GitLab from SANBI’s network, please shout to correct my untested aversion!</p>
<section id="sec-githubAuth" class="level3">
<h3 class="anchored" data-anchor-id="sec-githubAuth">GitHub authentication:</h3>
<p>Go to https://github.com/settings/tokens and click “Generate token” to generate your personal access token (PAT). Recommendation is to select <em>repo</em>, <em>user</em>, and <em>workflow</em> before confirming <em>Generate token</em>.</p>
<p>Ensure you safely store your PAT; this is your password for Git to communicate with GitHub!</p>
<p>Install the R package gitcreds and then pass your PAT to it to enable Git to pull and push changes from and to GitHub:</p>
<blockquote class="blockquote">
<p>gitcreds::gitcreds_set()</p>
</blockquote>
<p><strong>Note:</strong> If any Git operations require a password to access GitHub, enter the PAT, not your GitHub profile password.</p>
</section>
<section id="gitlab-authentication" class="level3">
<h3 class="anchored" data-anchor-id="gitlab-authentication">GitLab authentication</h3>
<p>You can create <a href="https://gitlab.com/-/user_settings/personal_access_tokens">access tokens</a> very similarly to GitHub (see <a href="#sec-githubAuth" class="quarto-xref">Section&nbsp;2.3.1</a>).</p>
<p>Unlike GitHub, GitLab allows you to use your GitLab profile username and password to authenticate. However, if you have enabled Two-Factor Authentication, then you must use a PAT as your password when prompted for Git operations.</p>
</section>
</section>
<section id="common-git-functions" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="common-git-functions"><span class="header-section-number">2.4</span> Common Git functions</h2>
<p>A general recommendation is to use cheat sheets when you’re learning a new tool, e.g.&nbsp;<a href="https://education.github.com/git-cheat-sheet-education.pdf">Git cheat sheet</a>.</p>
<p>RStudio has integrated Git functionality and a Git interface on RStudio becomes visible once you have initialised Git version control on that project (close and reopen RStudio if it doesn’t appear). The Git interface on RStudio provides buttons for the most common Git operations, which can alternatively be executed in a terminal. Sometimes you need to execute a command that is not covered by the buttons, so it is a good idea to become familiar with using the terminal (and many advanced users revert to using the terminal only).</p>
<section id="cloning-remote-repositories" class="level3">
<h3 class="anchored" data-anchor-id="cloning-remote-repositories">Cloning remote repositories</h3>
<p>Very often the first thing you might want to do, is to clone an online repository from platforms such as GitHub or GitLab. To do so, navigate to the online repository website and copy the relevant URL from the <em>Code</em> drop-down. In RStudio, create the new cloned project via <em>File &gt; New Project &gt; Version Control &gt; Git</em> and pasting the URL into the relevant space, checking that you’re happy with the project directory name and location, before confirming <em>Create Project</em>.</p>
<p>Alternatively, create a project folder, navigate to it with the terminal, and clone the project with the following code, but replacing the URL with the one copied from the repository:</p>
<blockquote class="blockquote">
<p>git clone https://github.com/username/repo.git</p>
</blockquote>
<p>This approach of cloning online repositories is how most of us novice Git users start a new project: We create a new empty project on GitHub/GitLab, clone it to our computers, and then start updating the <em>README.md</em> and create the project folders, files and update the .gitignore file(s). Once the basic parts are in place, we can do our first cycle of staging the changes, committing them to a version and pushing them to the remote repository.</p>
<p>You can <a href="https://www.theserverside.com/blog/Coffee-Talk-Java-News-Stories-and-Opinions/How-to-push-an-existing-project-to-GitHub">push an existing project to GitHub/GitLab</a>, however I’ve struggled to achieve this in the past. A way to circumvent it is to do the above clone and then copy and paste your project contents into the newly cloned (but mostly empty) project folder.</p>
<p>A second alternative, to push an existing project on your computer to GitHub, is to type <mark><em>usethis::use_github()</em></mark> in your R console (having installed the <em>usethis</em> package). Before doing so, you need to ensure that your R project has Git initialised. This should create a new GitHub repo named the same as your project and push your files to it. Remember to set up your .gitignore appropriately before pushing your project.</p>
</section>
<section id="pulling-updates" class="level3">
<h3 class="anchored" data-anchor-id="pulling-updates">Pulling updates</h3>
<p>To pull the latest version from the online repository (referred to as ‘remote’), use the <em>Pull</em> button on the Git pane in RStudio.</p>
<p>This is equivalent to typing the following in a terminal:</p>
<blockquote class="blockquote">
<p>git pull</p>
</blockquote>
<p>If you are collaborating with others on a project, it becomes vital to pull changes <strong>before</strong> you start making changes, so that you’re working with the latest additions from your team mates!</p>
</section>
<section id="git-status" class="level3">
<h3 class="anchored" data-anchor-id="git-status">Git status</h3>
<p>The Git pane in RStudio provides an easy overview of what the status is of your project, showing up files that have changed but are not yet committed. It also indicates whether they have changed, have been deleted, are newly created, etc. Similar (and more detailed information) can be viewed in a terminal with the command:</p>
<blockquote class="blockquote">
<p>git status</p>
</blockquote>
</section>
<section id="staging-changes" class="level3">
<h3 class="anchored" data-anchor-id="staging-changes">Staging changes</h3>
<p>Selecting the changed files that you want to commit, is referred to as <em>staging</em> them. The files that have not changed do not need to be staged (nor committed), but will be part of the commit version.</p>
<p>In RStudio, you stage the files by ticking their boxes in the <em>Staged</em> column of the Git pane.</p>
<p>In the terminal, you stage all modified files with:</p>
<blockquote class="blockquote">
<p>git add -A</p>
</blockquote>
<p>or if you want to add specific files, name them:</p>
<blockquote class="blockquote">
<p>git add filename1.ext filename2.ext filename3.ext</p>
</blockquote>
</section>
<section id="git-commit" class="level3">
<h3 class="anchored" data-anchor-id="git-commit">Git commit</h3>
<p>To ‘save’ or take a snapshot of your project folder with the staged file changes (and everything else not in <em>.gitignore</em>), you need to make a commit. You can stage and commit only certain (changed) files, while leaving other changed files unstaged and uncommited (leaving them in the previous committed version state).</p>
<p>To commit in RStudio, select the <em>Commit</em> button in the Git pane, with files selected for staging, add a commit message in the <em>Commit message</em> box and click <em>Commit</em>.</p>
<p>Alternatively, the terminal syntax is as follows:</p>
<blockquote class="blockquote">
<p>git commit -m “Your commit message describing what has changed.”</p>
</blockquote>
<p>or, if you would like to stage and commit your files in one step, you can use:</p>
<blockquote class="blockquote">
<p>git commit -a -m “Your commit message describing what has changed.”</p>
</blockquote>
<p>Try to write meaningful commit messages, both to help your collaborators understand the changes and in case you need to identify a specific commit in a few days, months (or years) time.</p>
</section>
<section id="pushing-changes" class="level3">
<h3 class="anchored" data-anchor-id="pushing-changes">Pushing changes</h3>
<p>After you have committed changes, those can be pushed to the remote repository by clicking the <em>Push</em> button on the Git pane in RStudio.</p>
<p>Alternatively, the terminal command is:</p>
<blockquote class="blockquote">
<p>git push</p>
</blockquote>
<p>If one of your teammates has pushed their changes to the online repository since your previous pull, you may get a ‘rejected’ error message, stating “Updates were rejected because the remote contains work that you do not have locally”.</p>
<p>In most instances, this can be easily resolved with a ‘Pull with Rebase’ (see the drop-down arrow next to the <em>Pull</em> button in RStudio or type <mark>git pull --rebase</mark> into a terminal).</p>
<p>However be very mindful that merge conflicts mean that the same lines of a file where changed to two different things by two different people (could even be you and your past self! If you forgot to pull changes you made on a different computer before you started working). The best way to deal with this is to then use git pull, which will give you merge conflicts and tell you which files have conflicting changes (or if you don’t have any conflicting changes it will just update your files with the latest online work and you can re-stage commit and push your work) look at which files have conflicts and look at them. The sections that have two ‘versions’ will have —HEAD followed by your most recent version, and then a second section of the previous/other version. You have to chose which version you want to keep, delete the HEAD and other git additions, restage and commit you accepted version and then you can push without trouble and you have fixed your merge conflicts.</p>
<p>An example of this workflow is:</p>
<p>$ git push To https://gitlab.com/nba_2025/git_tutorial.git ! [rejected] main -&gt; main (fetch first) error: failed to push some refs to ‘https://gitlab.com/nba_2025/git_tutorial.git’ hint: Updates were rejected because the remote contains work that you do not hint: have locally. This is usually caused by another repository pushing to hint: the same ref. If you want to integrate the remote changes, use hint: ‘git pull’ before pushing again. hint: See the ‘Note about fast-forwards’ in ‘git push –help’ for details.</p>
<p>N.Besseling@CPTLTP0048 MINGW64 ~/Documents/repos/git_tutorial (main) $ git pull remote: Enumerating objects: 36, done. remote: Counting objects: 100% (36/36), done. remote: Compressing objects: 100% (22/22), done. remote: Total 22 (delta 16), reused 0 (delta 0), pack-reused 0 (from 0) Unpacking objects: 100% (22/22), 2.68 KiB | 49.00 KiB/s, done. From https://gitlab.com/nba_2025/git_tutorial 5e29823..638bf52 main -&gt; origin/main Auto-merging quarto/collaborating_with_git.qmd CONFLICT (content): Merge conflict in quarto/collaborating_with_git.qmd Automatic merge failed; fix conflicts and then commit the result.</p>
<p>N.Besseling@CPTLTP0048 MINGW64 ~/Documents/repos/git_tutorial (main|MERGING) $ git commit -am “fixed merge conflicts” [main add7213] fixed merge conflicts</p>
<p>N.Besseling@CPTLTP0048 MINGW64 ~/Documents/repos/git_tutorial (main) $ git push Enumerating objects: 14, done. Counting objects: 100% (14/14), done. Delta compression using up to 22 threads Compressing objects: 100% (8/8), done. Writing objects: 100% (8/8), 936 bytes | 936.00 KiB/s, done. Total 8 (delta 6), reused 0 (delta 0), pack-reused 0 (from 0) To https://gitlab.com/nba_2025/git_tutorial.git 638bf52..add7213 main -&gt; main</p>
</section>
<section id="git-diff" class="level3">
<h3 class="anchored" data-anchor-id="git-diff">git diff</h3>
<p>Highlighting the differences between two versions of the same file can be very useful when trouble-shooting a merge conflict or trying to remind yourself of what changes you’ve made (if any). The <em>Diff</em> button on RStudio’s Git pane does that for you and by default shows up any changed files that have not yet been committed. Similar can be achieved from the command line with</p>
<blockquote class="blockquote">
<p>git diff</p>
</blockquote>
<p>to scroll through all the changes for each file, or to examine a specific file, by adding its name:</p>
<blockquote class="blockquote">
<p>git diff filename.ext</p>
</blockquote>
</section>
<section id="git-log" class="level3">
<h3 class="anchored" data-anchor-id="git-log">Git log</h3>
<p>Want to see the history of Git commits (and branches) on your project? In RStudio, you can click on the <em>History</em> button in the Git pane (note: not the <em>History</em> pane of your project), which shows you the sequence of previous commits and provides a visual representation of branches.</p>
<p>That information is taken from the Git log, which can be accessed on the terminal with:</p>
<blockquote class="blockquote">
<p>git log</p>
</blockquote>
</section>
<section id="the-most-common-git-tasks" class="level3">
<h3 class="anchored" data-anchor-id="the-most-common-git-tasks">The most common Git tasks</h3>
<p>Although there are many more Git commands and most of them can be elaborated on with several options or additional arguments, by far the most common sequence of tasks for us tend to be:</p>
<ul>
<li><strong>git pull</strong> to ensure we have the newest version;</li>
<li><strong>git add .</strong> to stage changed files, followed by</li>
<li><strong>git commit -m “descriptive commit message”</strong> to commit the changes;</li>
<li><strong>git push</strong> to push them to the remote repository;</li>
<li><strong>git pull --rebase</strong> if the push threw a merge conflict, followed by another <strong>git push</strong></li>
</ul>
<p>If you are facing problems getting Git and GitHub/GitLab to work with RStudio, try to read <a href="https://happygitwithr.com/troubleshooting">Happy Git and GitHub for the useR</a> or other online resources.</p>
<p>Remember to never create a Git repository inside another Git repository.</p>
</section>
</section>
<section id="the-importance-of-.gitignore" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="the-importance-of-.gitignore"><span class="header-section-number">2.5</span> The importance of <em>.gitignore</em></h2>
<p>The <em>.gitignore</em> file is a text file that lists which files (or directories) should not be tracked by Git. In other words, those files/directories listed will not appear at all in the Git repository and any changes to them will not be tracked.</p>
<p>This is useful for many different contexts, e.g.:</p>
<ul>
<li>sensitive input or output files you do not want shared with those accessing your project;<br>
</li>
<li>your secret credentials saved in the <em>.Renviron</em> file (see <a href="#sec-renviron" class="quarto-xref">Section&nbsp;2.6</a>);<br>
</li>
<li>large files that will cause you to exceed file size or repository size limits;</li>
<li>temporary files or other files that change frequently but have no bearing on project contents;</li>
</ul>
</section>
<section id="sec-renviron" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="sec-renviron"><span class="header-section-number">2.6</span> The <em>.Renviron</em> file</h2>
<p>Any login credentials (e.g.&nbsp;username and password to access your databases) or other sensitive information that you want accessible to your R session, but which you do not want to share with collaborators (or the public if your project is public), you should add to a special file named <em>.Renviron</em>. This text file is treated in a special way, in that objects defined in it are automatically loaded into your R environment when you open your project in RStudio. If you want the same credentials accessible across all your R projects, you can save such information in an <em>.Renviron</em> file in your <em>HOME</em> directory. If you want different credentials accessible to different projects, you can instead create a project-specific <em>.Renviron</em> file in your project root directory. Remember, if you make changes in your .Renviron file, you need to restart R to load those changes.</p>
<p><strong>Very important:</strong> Make a habit of adding ‘.Renviron’ to your <em>.gitignore</em> file, so that the sensitive information you have put there is not pushed to your online repository!</p>
</section>
<section id="things-to-watch-out-for" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="things-to-watch-out-for"><span class="header-section-number">2.7</span> Things to watch out for</h2>
<p>Always review and be certain about what is included or not included in <em>.gitignore</em>. We need to be careful to not share (push) sensitive data or credentials - e.g.&nbsp;it would be a horrible mistake to push your collaborator’s highly sensitive data to a public Git repository!</p>
<p>Large file size limits and overall repository size limits need to be taken into consideration. For example, if you create (or include) a file &gt; 100 MB in your project, you’ll be able to commit it on Git on your local machine, but when you try to push that commit to GitLab, it will be rejected (and can get complicated quickly).</p>
</section>
</section>
<section id="the-importance-of-branches" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> The importance of branches</h1>
<p>Once a project has become mature (contains a substantial amount of work and is worth protecting), it becomes important that further development moves to separate ‘feature’ branches and collaborators avoid making changes directly to the main branch. A branch represents a complete working copy of the project and anything changed on a feature branch has no bearing on the main branch, until it is explicitly merged into the main branch, transferring its updates into the main branch. The developer of the feature branch opens a ‘merge request’ on GitLab/GitHub, once their changes have been tested and reviewed (make sure they don’t break anything!). The owner(s) of the project are responsible for reviewing the changes and deciding whether they approve the merge or not. Typically (and by default settings), a feature branch is deleted once it has been merged into a main branch, as that updated work has moved into the main branch.</p>
<p>In RStudio, a branch is easily created by clicking the <em>New Branch</em> button in the Git pain. Give it a concise but descriptive name. The same can be achieved in the terminal with:</p>
<blockquote class="blockquote">
<p>git checkout -b add_threat_plot</p>
</blockquote>
<p>which is the single-step equivalent of:</p>
<blockquote class="blockquote">
<p>git branch add_threat_plot git checkout add_threat_plot</p>
</blockquote>
<p>Once you start collaborating on projects, it becomes especially important to pull and push frequently. Before you start working on a new feature, pull the remote project, in case your teammates have made some changes since you last worked on it. Otherwise, you’ll be adding your changes to an outdated version!</p>
<p><strong>Warning:</strong> Always double-check which branch you’re working on before making your changes. If you forget to, there are ways of <a href="https://stackoverflow.com/questions/1394797/move-existing-uncommitted-work-to-a-new-branch-in-git">moving your changes to another branch</a>.</p>
<p><a href="https://raps-with-r.dev/github.html">Creating issues (on GitLab/GitHub) and then closing those issues with a commit</a>, is a really nice way of documenting updates. Issues are used to document problems in the project code, or wishlist features to add in future. When those problems or wishlist items are addressed, the commit message can simply reference the issue number (e.g.&nbsp;<mark>“fixed #28</mark>), which will automatically close that issue number.</p>
</section>
<section id="sec-datarepo" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> A centralised data repository (with SANBI IT systems)</h1>
<p>Reproducible science requires us to apply exactly the same methods to exactly the same datasets. Sharing scripted workflows goes a long way to make methods reproducible, but another critical aspect is ensuring that the input data are identical. If we all have our own copy of input datasets on our machines, how do we ensure that they always remain the same, including when the data manager/owner updates them with new data or corrections? Below is a suggested approach that we are starting to implement. If anyone foresees problems with it, or if you have other solutions, please share!</p>
<p>Within the <em>SANBI Marine Programme</em> Team (Microsoft Teams), we have a ‘marine_data’ channel, where we curate all of our spatial layers and datasets. Because it includes datasets that have sharing and usage restrictions, it is a private (protected) channel and membership is restricted to those who need it. Although not critical to this demonstration, the data are grouped in thematic subfolders and a data inventory (spreadsheet) in the root folder captures the metadata and the location (folder path) of the datasets. This Teams channel is our ‘centralised and authoritative data’ storage. The advantage of using a Teams channel rather than a staff member’s OneDrive account, is that the channel should be safe and persist irrespective of staff turnover. If datasets are updated, they need to be updated here and tracked in the data inventory.</p>
<p>Up until a few days ago, we manually downloaded a copy of the data to our computers. We had to remember to re-download the relevant folder or dataset if changes were made to them. However, Natasha recently noticed that we can add a shortcut to the Teams channel in our OneDrive account, and the OneDrive account is synced to our computers.</p>
<p>Lets try this:</p>
<ol type="1">
<li><p>Navigate to your MS Teams and to the nba_data channel within the NBA_data team.</p></li>
<li><p>Click on ‘Add shortcut to OneDrive’ in the options near the top (center) of the screen.</p></li>
<li><p>If it is not already, set up your computer to <a href="https://support.microsoft.com/en-us/office/sync-files-with-onedrive-in-windows-615391c4-2bd3-4aae-a42a-858262e42a49">sync your OneDrive account</a> (or certain parts of it), including the newly added <em>nba_data</em> folder.</p></li>
</ol>
<p>If you manage that, you have a synced version of the Teams data folder on your computers and multiple people can access the same dataset. Any updates or changes made to that dataset on Teams will sync through to everyone’s OneDrive and their computer (when they next access that file).</p>
<p>Lets try the same exercise as above in <a href="#sec-avoidDupl" class="quarto-xref">Section&nbsp;1.1</a>, but this time create a symbolic link from your project data drive to the nba_data folder we just added to OneDrive. For me, this was typing the following into Windows Command Prompt:</p>
<p>mklink /d “C:\Users\J.Currie\Documents\Rprojects\git_tutorial\data\link2nba_data” “C:\Users\J.Currie\OneDrive\OneDrive - sanbi.org.za\shortcut_to_nba_data”</p>
<p>So, now we can all access the same nba_data datasets with our R projects.</p>
<p><strong>But, beware:</strong></p>
<ol type="1">
<li><p>Never write to your data (input) folder! This rule becomes absolutely critical if we are all sharing access to a central authoritative data repository. These data are not your personal copy! Do not make changes to them unless you are the authority/owner/data manager or have explicit permission or instruction to do so. (Having read-only access would be ideal if we can configure that)</p></li>
<li><p>Unless it is appropriate to share your input data with the online repository (and the data folder does not exceed your online repo size limits), you may likely want to add the linked folder (‘link2nba_data’ in the above example) to your .gitignore file. I already did this for this tutorial, because I wanted you to add those data as a linked folder via your OneDrive account and not receive them when you cloned the online repo.</p></li>
</ol>
<p>Lets load some of the data and play with them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load the spatial features and dplyr packages (install them if you have not yet done so)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"nbaR"</span>)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"SANBI-NBA/nbaR"</span>); <span class="fu">library</span>(nbaR)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">## create file paths (find the correct path, which can vary among different machines)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>mem_fl <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>), <span class="at">pattern =</span> <span class="st">"^Marine_Ecosystem_Map_2023_final_pelagic_only.gpkg$"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>threat_fl <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>), <span class="at">pattern =</span> <span class="st">"^nba_example_thr_data.csv$"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>bar_plot <span class="ot">&lt;-</span> <span class="fu">nba_plot</span>(NBA_example_thr_data,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">OVERALL types</span><span class="st">`</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">CHRT =</span> <span class="st">"bar"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">NUM =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">LAB =</span> <span class="st">"Percentage of ecosystem types"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">SAVE =</span> <span class="cn">NULL</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>bar_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="collaborating_with_git_files/figure-html/load_nba_data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="general-notes-on-good-data-hygiene-see-borer-et-al.-2009" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> General notes on good data hygiene (See Borer et al.&nbsp;2009)</h1>
<p>Use descriptive, standardised names for your files and folder names. Avoid spaces, use underscores or dashes instead.</p>
<p>Use plain ASCII text for your file names, variable names, and data values. Avoid spaces, brackets or other special characters that will cause you pain in programming tasks.</p>
<p>Have your data in long table format (add data in rows, not columns).</p>
<p>Each column should contain only one type (class) of information (either text, numeric, etc.).</p>
<p>Always maintain effective metadata: clear, unambiguous, comprehensive.</p>
<p>Use a scripted program for analysis.</p>
<p>Store data in non-proprietary software formats and consider hardware formats &amp; longevity (save data from those floppy disks!).</p>
<p>Always store an uncorrected, original data file.</p>
</section>
<section id="references" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> References</h1>
<p>Borer ET, Seabloom EW, Jones MB, Schildhauer M (2009) Some Simple Guidelines for Effective Data Management. The Bulletin of the Ecological Society of America 90:205–214. doi: 10.1890/0012-9623-90.2.205</p>
<p>Bryan J. <a href="https://happygitwithr.com/">Happy Git and GitHub for the useR.</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>